angular.module("starter",["ionic","starter.controllers","starter.services"]).config(function(o){o.tabs.position("bottom")}).run(function(o){o.ready(function(){window.cordova&&window.cordova.plugins&&window.cordova.plugins.Keyboard&&cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!0),window.StatusBar&&StatusBar.styleLightContent()})}).config(function(o,e){o.state("login",{url:"/login",templateUrl:"templates/login.html",controller:"LoginCtrl"}).state("registration",{url:"/registration",templateUrl:"templates/registration.html",data:{"public":!0}}).state("geolocation",{url:"/geolocation",templateUrl:"templates/geolocation.html",data:{"public":!0}}).state("tab",{url:"/tab","abstract":!0,templateUrl:"templates/tabs.html"}).state("tab.restaurants",{url:"/restaurants",views:{"tab-restaurants":{templateUrl:"templates/tab-restaurants.html",controller:"RestaurantsCtrl"}}}).state("tab.restaurant-detail",{url:"/restaurants/:restaurantId",views:{"tab-restaurants":{templateUrl:"templates/restaurant-detail.html",controller:"RestaurantDetailCtrl"}}}).state("tab.favorites",{url:"/favorites",views:{"tab-favorites":{templateUrl:"templates/tab-favorites.html",controller:"FavoritesCtrl"}},reload:!0}),e.otherwise("/login")}),angular.module("starter.services",[]).factory("Restaurants",function(o){var e={},t=new PouchDB("restaurants");return{choose:function(o){var n=({_id:e.data.username,likes:o.name},t.get(e.data.username).then(function(n){return likedRestaurants=n.likes.split(","),likedRestaurants.indexOf(o.name)>-1?void console.log("You got it"):t.put({_id:e.data.username,likes:n.likes+","+o.name,_rev:n._rev})}));n.then(function(o){console.log("doc updated"),console.log(o)}),n["catch"](function(n){console.log("doc doesn't exist"),t.put({_id:e.data.username,likes:o.name}).then(function(o){console.log("doc created"),console.log(o)})["catch"](function(o){console.log("doc could not be created"),console.log(o)})})},get:function(){var e=o.defer();return t.allDocs({include_docs:!0,descending:!0}).then(function(o){for(console.log("docs fetched"),favorites=[],i=0;i<o.rows.length;i++)name=o.rows[i].doc._id.split("@")[0],likes=o.rows[i].doc.likes,photo="https://outlook.office365.com/EWS/Exchange.asmx/s/GetUserPhoto?email="+o.rows[i].doc._id+"&size=HR64x64",favorites.push({name:name,likes:likes,photo:photo});console.log("fav"),console.log(favorites),e.resolve(favorites)})["catch"](function(o){console.log("Error fetching docs"),console.log(o)}),e.promise},saveCurrentSessionInfo:function(o,t){console.log("Saving"),e={data:o,photo:t},console.log(e)}}}),angular.module("starter.controllers",["ionic","ngCordova"]).controller("MapController",function(o,e){var t=new google.maps.LatLng(37.3,-120.4833),n={center:t,zoom:16,mapTypeId:google.maps.MapTypeId.ROADMAP},a=new google.maps.Map(document.getElementById("map"),n);navigator.geolocation.getCurrentPosition(function(o){a.setCenter(new google.maps.LatLng(o.coords.latitude,o.coords.longitude));new google.maps.Marker({position:new google.maps.LatLng(o.coords.latitude,o.coords.longitude),map:a,title:"My Location"})}),console.log("this is position"),o.map=a}).controller("myCtrl",function(o,e){o.toggle=function(){var t={timeout:1e4,enableHighAccuracy:!0};e.getCurrentPosition(t).then(function(e){o.lat=e.coords.latitude,o["long"]=e.coords.longitude},function(o){})}}).controller("FavoritesCtrl",function(o,e,t){t.get().then(function(e){o.favorites=e}),o.doRefresh=function(){t.get().then(function(e){o.favorites=e}),o.$broadcast("scroll.refreshComplete")}}).controller("RestaurantsCtrl",function(o,e,t,n,a){function s(e){var t=new google.maps.LatLng(e.lat(),e.lng()),n=new google.maps.LatLng(o.position.latitude,o.position.longitude);console.log(typeof("distance is "+google.maps.geometry.spherical.computeDistanceBetween(t,n)));var a=google.maps.geometry.spherical.computeDistanceBetween(t,n)/1e3;return parseFloat(a).toFixed(2)}restaurants=[],distance=[],navigator.geolocation.getCurrentPosition(function(e){function t(e,t,a){if(console.log("Here!"),t!=google.maps.places.PlacesServiceStatus.OK)return console.log("NOO"),void console.log(t);for(l=0;1>l;l++){for(var l=0;l<e.length;l++)restaurants.push(e[l]),distance.push(s(e[l].geometry.location)+" kilometers away");if(!a.hasNextPage){o.$apply(function(){o.restaurants=restaurants,o.distance=distance,n.hide()});break}a.nextPage()}}o.position=e.coords,console.log("Position:"),console.log(e.coords.longitude);var a,l,r=new google.maps.LatLng(e.coords.latitude,e.coords.longitude);a=new google.maps.Map(document.getElementById("map"));var i={location:r,types:["restaurant"],rankBy:google.maps.places.RankBy.DISTANCE};l=new google.maps.places.PlacesService(a),l.nearbySearch(i,t)},function(o){console.log("error"),console.log(JSON.stringify(o))}),o.choose=function(e){console.log("Data"),console.log(o.data),a.choose(e)}}).controller("RestaurantDetailCtrl",function(o,e,t,n,a,s,l){function r(e,t){if(t==google.maps.places.PlacesServiceStatus.OK)if(o.restaurant=e,"undefined"!=typeof e.photos){for(i=0;i<e.photos.length;i++)src=e.photos[i].getUrl({maxWidth:400,maxHeight:400}),msg="Image "+(i+1)+"/"+e.photos.length,photos.push({src:src,msg:msg});o.$apply(function(){o.photos=photos})}else console.log("no image")}var c={placeId:e.restaurantId};map=new google.maps.Map(document.getElementById("map")),service=new google.maps.places.PlacesService(map),service.getDetails(c,r),photos=[],a.fromTemplateUrl("image-modal.html",{scope:o,animation:"slide-in-up"}).then(function(e){o.modal=e}),o.openModal=function(){s.slide(0),o.modal.show()},o.closeModal=function(){o.modal.hide()},o.$on("$destroy",function(){o.modal.remove()}),o.$on("modal.hide",function(){}),o.$on("modal.removed",function(){}),o.$on("modal.shown",function(){console.log("Modal is shown!")}),o.next=function(){s.next()},o.previous=function(){s.previous()},o.goToSlide=function(e){o.modal.show(),s.slide(e)},o.slideChanged=function(e){o.slideIndex=e}}).controller("LoginCtrl",function(o,e,t,n,a){o.data={},o.login=function(){if("Admin"==o.data.username&&"Admin"==o.data.password)n.go("geolocation");else{t.alert({title:"Login failed!",template:"Please check your credentials!"})}}});